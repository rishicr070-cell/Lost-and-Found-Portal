<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Connection Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .test-box {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .success {
            color: green;
        }

        .error {
            color: red;
        }

        .info {
            color: blue;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #5568d3;
        }

        #log {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>

<body>
    <h1>üî• Firebase Connection Test</h1>

    <div class="test-box">
        <h2>Connection Status</h2>
        <div id="status">Testing connection...</div>
    </div>

    <div class="test-box">
        <h2>Test Actions</h2>
        <button onclick="testWrite()">Test Write Item</button>
        <button onclick="testRead()">Test Read Items</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <div class="test-box">
        <h2>Console Log</h2>
        <div id="log"></div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAALYUIoqn14jmUnDZB0ORkpBsFrivzLlU",
            authDomain: "lostfoundportal-dsa.firebaseapp.com",
            projectId: "lostfoundportal-dsa",
            storageBucket: "lostfoundportal-dsa.firebasestorage.app",
            messagingSenderId: "1032918662830",
            appId: "1:1032918662830:web:d2a2fae6b1f656cc0eb73f",
            measurementId: "G-TZR77G82ZG"
        };

        let db;
        let auth;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff4444' : type === 'success' ? '#00ff00' : '#00aaff';
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        // Initialize
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            auth = firebase.auth();

            log('‚úÖ Firebase initialized successfully!', 'success');
            document.getElementById('status').innerHTML = '<span class="success">‚úÖ Connected to Firebase</span>';

            // Test Firestore connection
            db.collection('items').limit(1).get()
                .then(() => {
                    log('‚úÖ Firestore connection verified!', 'success');
                })
                .catch(error => {
                    log('‚ùå Firestore connection error: ' + error.message, 'error');
                    document.getElementById('status').innerHTML = '<span class="error">‚ùå Firestore Error: ' + error.message + '</span>';
                });

        } catch (error) {
            log('‚ùå Firebase initialization error: ' + error.message, 'error');
            document.getElementById('status').innerHTML = '<span class="error">‚ùå Connection Failed: ' + error.message + '</span>';
        }

        // Test write
        async function testWrite() {
            log('üìù Testing write operation...');

            const testItem = {
                name: 'Test Item ' + Date.now(),
                category: 'Electronics',
                description: 'This is a test item',
                date: new Date().toISOString().split('T')[0],
                location: 'Test Location',
                color: 'Blue',
                contact: 'test@example.com',
                type: 'lost',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                const docRef = await db.collection('items').add(testItem);
                log('‚úÖ Item written successfully! ID: ' + docRef.id, 'success');
                log('   Item name: ' + testItem.name, 'info');
            } catch (error) {
                log('‚ùå Write error: ' + error.message, 'error');
                log('   Error code: ' + error.code, 'error');

                if (error.code === 'permission-denied') {
                    log('‚ö†Ô∏è  PERMISSION DENIED - Check Firestore rules!', 'error');
                    log('   You may need to enable authentication or update security rules', 'error');
                }
            }
        }

        // Test read
        async function testRead() {
            log('üìñ Testing read operation...');

            try {
                const snapshot = await db.collection('items').limit(5).get();
                log('‚úÖ Read successful! Found ' + snapshot.size + ' items', 'success');

                snapshot.forEach(doc => {
                    const data = doc.data();
                    log('   - ' + data.name + ' (' + data.type + ')', 'info');
                });

                if (snapshot.empty) {
                    log('   No items in database', 'info');
                }
            } catch (error) {
                log('‚ùå Read error: ' + error.message, 'error');
                log('   Error code: ' + error.code, 'error');
            }
        }

        // Check auth state
        auth.onAuthStateChanged((user) => {
            if (user) {
                log('üë§ User logged in: ' + user.email, 'success');
            } else {
                log('üë§ No user logged in (anonymous mode)', 'info');
            }
        });
    </script>
</body>

</html>